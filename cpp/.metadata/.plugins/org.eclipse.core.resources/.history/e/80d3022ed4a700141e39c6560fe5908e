/*
 * main.cpp
 *
 *  Created on: Jan 28, 2015
 *      Author: strogos
 */

#include "ace/OS.h"
#include "ace/INET_Addr.h"
#include "ace/Log_Msg.h" /*for ACE_ERROR_RETURN and messaging*/
#include "ace/SOCK_Connector.h"
#include "ace/SOCK_Acceptor.h"
#include "ace/SOCK_Stream.h"
//#include "ace/"

#include <iostream>
using namespace std;


int tstTCP_client();
int tstTCP_srvr();


int main(int argc, char *argv[])
{
	const char *pathname =
					argc > 1 ? argv[1] : "index.html";
	const char *server_hostname =
					argc > 2 ? argv[2] : "ace.ece.uci.edu";

	//tstTCP_client();


	return 0;
}

int tstTCP_client()
{


		ACE_INET_Addr srvr("129.241.187.147:32000");
		ACE_SOCK_Connector connector;
		ACE_Time_Value timeout(10);//timout: 10uS
		ACE_SOCK_Stream peer;

		if (connector.connect(peer,srvr,&timeout)==-1)
		{
			if (ACE_OS::last_error()==ETIME)
			{
				ACE_DEBUG((LM_DEBUG,
						ACE_TEXT("(%P|%t) Timout while "),
						ACE_TEXT("connecting to server\n")));
			}
			else
			{
				ACE_ERROR((LM_ERROR,
						ACE_TEXT("%p\n"),
						ACE_TEXT("peer")));
			}

			return (101);
		}
		peer.send_n("uptime\n",7);

		char buff[64];
		int bc = peer.recv(buff,sizeof(buff));

		cout<<"output bc: "<<bc<<endl;
		cout<<"output buff: "<<buff<<"\n";

		return 0;
}

int tstTCP_srvr()
{
	ACE_INET_Addr port_to_listen("HAStatus");
	ACE_SOCK_Acceptor acceptor;
	if (acceptor.open(port_to_listen,1)==-1)
		ACE_ERROR_RETURN((LM_ERROR,
				ACE_TEXT("%p\n"),
				ACE_TEXT("acceptor.open"),100));

	return 0;
}
